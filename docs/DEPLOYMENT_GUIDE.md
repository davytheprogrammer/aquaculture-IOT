# ğŸš€ ESP32-S3 Aquaculture IoT System - Deployment Guide

## ğŸ“‹ Pre-Deployment Checklist

### Hardware Requirements
- [ ] ESP32-S3 development board
- [ ] DHT22 sensor (air temperature/humidity)
- [ ] DS18B20 waterproof temperature sensor
- [ ] pH sensor with BNC connector
- [ ] Turbidity sensor
- [ ] Dissolved oxygen sensor (optional)
- [ ] Ammonia sensor (optional)
- [ ] Breadboard or PCB for connections
- [ ] Jumper wires and connectors
- [ ] 3.3V power supply (minimum 500mA)
- [ ] Waterproof enclosure

### Software Requirements
- [ ] ESP-IDF v5.x installed
- [ ] Git for version control
- [ ] Serial terminal (PuTTY, screen, or idf.py monitor)
- [ ] Supabase account and project setup

## ğŸ”§ Hardware Assembly

### Pin Connections

```
ESP32-S3 Pin Layout:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3V3  GND  GPIO4  GPIO5  GPIO14     â”‚
â”‚  â”‚    â”‚     â”‚      â”‚      â”‚         â”‚
â”‚  â”‚    â”‚     â”‚      â”‚      â””â”€ Pump Control
â”‚  â”‚    â”‚     â”‚      â””â”€ DS18B20 (Water Temp)
â”‚  â”‚    â”‚     â””â”€ DHT22 (Air Temp/Humidity)
â”‚  â”‚    â””â”€ Common Ground
â”‚  â””â”€ 3.3V Power Supply
â”‚                                     â”‚
â”‚ ADC Channels: A0-A3                 â”‚
â”‚  A0: pH Sensor                      â”‚
â”‚  A1: Turbidity Sensor               â”‚
â”‚  A2: Dissolved Oxygen (optional)    â”‚
â”‚  A3: Ammonia Sensor (optional)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Sensor Installation

1. **DHT22 (Air Temperature/Humidity)**
   ```
   DHT22 â†’ ESP32-S3
   VCC   â†’ 3.3V
   GND   â†’ GND
   DATA  â†’ GPIO4
   ```

2. **DS18B20 (Water Temperature)**
   ```
   DS18B20 â†’ ESP32-S3
   RED     â†’ 3.3V
   BLACK   â†’ GND
   YELLOW  â†’ GPIO5 (with 4.7kÎ© pull-up to 3.3V)
   ```

3. **pH Sensor**
   ```
   pH Module â†’ ESP32-S3
   VCC       â†’ 3.3V
   GND       â†’ GND
   OUT       â†’ GPIO1 (ADC1_CH0)
   ```

## ğŸ’¾ Software Installation

### 1. Environment Setup

```bash
# Install ESP-IDF
mkdir -p ~/esp
cd ~/esp
git clone --recursive https://github.com/espressif/esp-idf.git
cd esp-idf
./install.sh esp32s3
source export.sh
```

### 2. Project Configuration

```bash
# Clone repository
git clone https://github.com/davytheprogrammer/aquaculture-IOT.git
cd aquaculture-IOT

# Configure WiFi credentials
nano main/aquaculture_monitor.c
# Update wifi_networks[] array:
wifi_cred_t wifi_networks[] = {
    {"YOUR_WIFI_SSID", "YOUR_PASSWORD"},
    {"BACKUP_WIFI", "BACKUP_PASSWORD"}
};
```

### 3. Supabase Configuration

```bash
# Update Supabase settings in main/aquaculture_monitor.c
#define SUPABASE_URL "https://YOUR_PROJECT.supabase.co/rest/v1/sensor_data"
#define SUPABASE_KEY "YOUR_ANON_KEY"
```

### 4. Build and Flash

```bash
# Configure project
idf.py menuconfig
# Set: Serial flasher config â†’ Flash size: 4MB

# Build project
idf.py build

# Flash to device
idf.py -p /dev/ttyUSB0 flash monitor
```

## ğŸŒ Cloud Setup (Supabase)

### Database Schema

```sql
CREATE TABLE public.sensor_data (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
  air_temperature DOUBLE PRECISION NULL,
  humidity DOUBLE PRECISION NULL,
  ph DOUBLE PRECISION NULL,
  ph_relay BOOLEAN NULL,
  created_at TIMESTAMP WITH TIME ZONE NULL DEFAULT NOW(),
  user_id UUID NULL,
  water_temperature DOUBLE PRECISION NULL,
  dissolved_oxygen DOUBLE PRECISION NULL,
  turbidity DOUBLE PRECISION NULL,
  ammonia DOUBLE PRECISION NULL,
  aerator BOOLEAN NULL,
  filter BOOLEAN NULL,
  pump BOOLEAN NULL,
  CONSTRAINT sensor_data_pkey PRIMARY KEY (id)
);
```

### API Configuration

1. **Get Supabase Credentials**
   - Project URL: `https://YOUR_PROJECT.supabase.co`
   - Anon Key: From Settings â†’ API

2. **Test API Connection**
   ```bash
   curl -X POST 'https://YOUR_PROJECT.supabase.co/rest/v1/sensor_data' \
   -H "apikey: YOUR_ANON_KEY" \
   -H "Authorization: Bearer YOUR_ANON_KEY" \
   -H "Content-Type: application/json" \
   -d '{"air_temperature": 25.0, "humidity": 60.0}'
   ```

## ğŸ” System Verification

### Boot Sequence Check

Expected serial output:
```
I (1234) AQUA: ğŸš€ Aquaculture Monitor Starting...
I (1245) AQUA: ğŸ“¡ WiFi connecting to: YOUR_WIFI_SSID
I (3456) AQUA: âœ… WiFi connected! IP: 192.168.1.100
I (3467) AQUA: ğŸŒ¡ï¸ Water Temp: 24.8Â°C
I (3478) AQUA: ğŸ§ª pH: 7.2
I (3489) AQUA: ğŸ’§ Turbidity: 15.3 NTU
I (3500) AQUA: ğŸ“¤ Sending data to Supabase...
I (4567) AQUA: âœ… Data sent successfully!
```

### Sensor Validation

1. **Temperature Sensors**
   - DHT22: Should read room temperature (18-30Â°C)
   - DS18B20: Should read water temperature

2. **Analog Sensors**
   - pH: Should read 6.5-8.5 for normal water
   - Turbidity: Varies based on water clarity

3. **Database Verification**
   ```sql
   SELECT * FROM sensor_data ORDER BY created_at DESC LIMIT 5;
   ```

## ğŸ“Š Monitoring & Maintenance

### Performance Monitoring

```bash
# Monitor system logs
idf.py -p /dev/ttyUSB0 monitor | tee system_logs.txt

# Check memory usage
grep "Free heap" system_logs.txt

# Monitor network performance
grep "HTTP" system_logs.txt
```

### Regular Maintenance

| Task | Frequency | Procedure |
|------|-----------|-----------|
| **Sensor Calibration** | Monthly | Use standard solutions |
| **System Reboot** | Weekly | Power cycle device |
| **Log Review** | Daily | Check for errors |
| **Database Cleanup** | Monthly | Archive old data |

### Troubleshooting Quick Fixes

1. **WiFi Issues**
   ```bash
   # Reset WiFi configuration
   idf.py -p /dev/ttyUSB0 erase-flash
   idf.py -p /dev/ttyUSB0 flash
   ```

2. **Sensor Errors**
   - Check physical connections
   - Verify power supply voltage
   - Clean sensor probes

3. **Database Errors**
   - Verify API key validity
   - Check network connectivity
   - Review JSON payload format

## ğŸ”’ Security Considerations

### Network Security
- Use WPA2/WPA3 encryption
- Change default router passwords
- Enable MAC address filtering if needed

### API Security
- Rotate Supabase API keys regularly
- Enable Row Level Security (RLS)
- Monitor API usage logs

### Physical Security
- Use tamper-evident enclosures
- Secure cable connections
- Install in protected locations

## ğŸ“ˆ Scaling & Expansion

### Multiple Device Deployment

1. **Device Identification**
   ```c
   // Add unique device ID
   uint8_t mac[6];
   esp_wifi_get_mac(WIFI_IF_STA, mac);
   char device_id[18];
   sprintf(device_id, "%02X:%02X:%02X:%02X:%02X:%02X", 
           mac[0], mac[1], mac[2], mac[3], mac[4], mac[5]);
   ```

2. **Database Schema Update**
   ```sql
   ALTER TABLE sensor_data ADD COLUMN device_id VARCHAR(17);
   CREATE INDEX idx_device_id ON sensor_data(device_id);
   ```

### Remote Management

1. **OTA Updates**
   ```c
   // Enable OTA in menuconfig
   // Component config â†’ App Update â†’ Enable OTA
   ```

2. **Remote Configuration**
   - Store settings in Supabase
   - Implement configuration polling
   - Support remote sensor calibration

---

*This deployment guide provides step-by-step instructions for successful system installation and operation.*
